---
title: "ObesityModel"
author: "Kaiyan Li, Kirill Gavrilov, Victor Wang"
date: "28/11/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      tidy.opts = list(width.cutoff = 80), tidy = TRUE)
```

# Introduction
Center for Disease Control (CDC) collected data from 2011-2016 in all states of America. In particular, responses were sampled for 9 different categories: 

* Percent of adults aged 18 years and older who have obesity
* Percent of adults aged 18 years and older who have an overweight classification
* Percent of adults who report consuming fruit less than one time daily
* Percent of adults who report consuming vegetables less than one time daily
* Percent of adults who engage in muscle-strengthening activities on 2 or more days a week
* Percent of adults who achieve at least 150 minutes a week of moderate-intensity aerobic physical activity or 75 minutes a week of vigorous-intensity aerobic activity (or an equivalent combination)
* Percent of adults who achieve at least 150 minutes a week of moderate-intensity aerobic physical activity or 75 minutes a week of vigorous-intensity aerobic physical activity and engage in muscle-strengthening activities on 2 or more days a week
* Percent of adults who achieve at least 300 minutes a week of moderate-intensity aerobic physical activity or 150 minutes a week of vigorous-intensity aerobic activity (or an equivalent combination)
* Percent of adults who engage in no leisure-time physical activity

Our objective is to find whether or not there's relationship between any of these classifications. We would like to answer these questions: 

1. Is there relationship between *obesity rates* and *fruit/vegetable intake alongside physical activity*?
2. Is there evidence that *obesity rates* in the USA are growing?
3. Add more later


Firstly we need to analyze the original dataset, remove all the unnecessary variables and observations.
```{r message = FALSE}
library(tidyverse)
cdc = read.csv("Nutrition__Physical_Activity__and_Obesity_-_Behavioral_Risk_Factor_Surveillance_System.csv")

# Removing LocationAbbr, and renaming LocationDesc, DataSource, Topic, TopicID, ClassID, GeoLocation, Data_Value_Unit, Data_Value_Type, DataValueTypeID, Data_Value_Footnote_Symbol, StratificationCategoryId1, StratificationID1
cdc_adjusted = cdc %>% select(-YearEnd, -LocationAbbr, -Datasource, -Topic, -TopicID, -ClassID, -GeoLocation, -Data_Value_Unit, -Data_Value_Type, - DataValueTypeID, -Data_Value_Footnote_Symbol, -StratificationCategoryId1, -StratificationID1, -Data_Value_Alt, -Data_Value_Footnote, -Low_Confidence_Limit, -High_Confidence_Limit) %>% rename(Year = YearStart, Location = LocationDesc)

#Removing Virigin Islands because they have observations for only 2016
cdc_adjusted = cdc_adjusted[!(cdc_adjusted$Location == "Virgin Islands"),]
```


```{r}
#Percent of adults who report consuming fruit less than one time daily
Q18 <- cdc_adjusted %>% filter(QuestionID == 'Q018' )%>%select(-QuestionID) %>%
  rename(Class18=Class,Question18=Question, Data_Value18=Data_Value, Sample_Size18=Sample_Size)

#Percent of adults who report consuming vegetables less than one time daily
Q19 <- cdc_adjusted %>% filter(QuestionID == 'Q019' )%>%select(-QuestionID) %>%
  rename(Class19=Class,Question19=Question, Data_Value19=Data_Value, Sample_Size19=Sample_Size)

#Percent of adults aged 18 years and older who have obesity
Q36 <- cdc_adjusted %>% filter(QuestionID == 'Q036' )%>%select(-QuestionID) %>%
  rename(Class36=Class,Question36=Question, Data_Value36=Data_Value, Sample_Size36=Sample_Size)

#Percent of adults aged 18 years and older who have an overweight classification
Q37 <- cdc_adjusted %>% filter(QuestionID == 'Q037' )%>%select(-QuestionID)

#Percent of adults who achieve at least 150 minutes a week of moderate-intensity aerobic physical activity or 75 minutes a week of vigorous-intensity aerobic activity (or an equivalent combination)
Q43 <- cdc_adjusted %>% filter(QuestionID == 'Q043' )%>%select(-QuestionID)

#Percent of adults who achieve at least 150 minutes a week of moderate-intensity aerobic physical activity or 75 minutes a week of vigorous-intensity aerobic physical activity and engage in muscle-strengthening activities on 2 or more days a week
Q44 <- cdc_adjusted %>% filter(QuestionID == 'Q044' )%>%select(-QuestionID)

#Percent of adults who achieve at least 300 minutes a week of moderate-intensity aerobic physical activity or 150 minutes a week of vigorous-intensity aerobic activity (or an equivalent combination)
Q45 <- cdc_adjusted %>% filter(QuestionID == 'Q045' )%>%select(-QuestionID)

#Percent of adults who engage in muscle-strengthening activities on 2 or more days a week
Q46 <- cdc_adjusted %>% filter(QuestionID == 'Q046' )%>%select(-QuestionID)

#Percent of adults who engage in no leisure-time physical activity
Q47 <- cdc_adjusted %>% filter(QuestionID == 'Q047' )%>%select(-QuestionID) %>%
  rename(Class47=Class,Question47=Question, Data_Value47=Data_Value, Sample_Size47=Sample_Size)


total <- inner_join(Q18,Q19,by=c("Year","Location","Total", "Age.years.", "Education", "Gender", "Income", "Race.Ethnicity","LocationID","StratificationCategory1","Stratification1"))
total <-inner_join(total,Q36,by=c("Year","Location","Total", "Age.years.", "Education", "Gender", "Income", "Race.Ethnicity","LocationID","StratificationCategory1","Stratification1"))
total <-inner_join(total,Q47,by=c("Year","Location","Total", "Age.years.", "Education", "Gender", "Income", "Race.Ethnicity","LocationID","StratificationCategory1","Stratification1"))

```

We now want to analyze the ordinary least squares model that relates obesity rates to people who report eating fruit and vegetable less than 1 time a day and engage in no physical activity 
```{r}
model <- lm(Data_Value36 ~ Data_Value18 + Data_Value19 + Data_Value47, data=total)
summary(model)
anova(model)
```


Analyzing the ordinary least squares model that obesity rates to the year in order to conclude growing obesity rate in every state. 
```{r}
model_all_states = lm(Data_Value36 ~ Year, data = Q36)
```

P-value for the model does seem to indicated that there's evidence of significant relationship between obesity rates and year, however the R-squared is extremely low. Let's investigate more closely. 

```{r}
Q36 = Q36 %>% select(Year, Location, Class36, Question36, Data_Value36, Sample_Size36, Total) %>% arrange(Location)
Q36[Q36 == ""] = NA
Q36 = Q36 %>% drop_na()
ggplot(Q36, aes(x = Year, y = Data_Value36, colour = Location)) + geom_line()

reg_coef_all_states = Q36 %>% group_by(Location) %>%
  summarize(slope = lm(Data_Value36 ~ Year)$coef["Year"],
            pvalue = coef(summary(lm(Data_Value36 ~ Year)))[2,4]) 

Q36_reduced = reg_coef_all_states %>% filter(pvalue<0.05) %>% left_join(Q36)

ggplot(Q36, aes(x = Year, y = Data_Value36)) + geom_line(aes(group = Location), colour = "grey", alpha = 0.4) +
  geom_smooth(Q36_reduced, mapping = aes(x = Year, y = Data_Value36), colour = "red") +
  geom_line(Q36_reduced, mapping = aes(x = Year, y = Data_Value36, colour = Location), alpha = 0.3) + 
  geom_smooth(colour = "black")
```

```{r}
model_updated = lm(Data_Value36 ~ Year, data = Q36_reduced)
```



